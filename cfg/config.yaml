defaults:
  - _self_
  - model: dpnet
  - system: linear_system
  - override hydra/launcher: joblib
#  - override hydra/sweeper: optuna
#  - override hydra/sweeper/sampler: tpe

# Running hyperparameters
exp_name: test
seed: 0
device: 0
num_workers: 0           # Dataloader workers
debug: False
debug_loops: False
max_epochs: 200

# Markov Dynamics Model
model: dpnet
# Dynamical system
system: linear_system

#run_name:
# Hydra configuration _________
hydra:
  verbose: ${debug}
  launcher:
    n_jobs: 1 # ${hydra.sweeper.n_jobs}
  run:
    dir: ./experiments/${hydra.job.name}/${system.summary}_${model.summary}_${hydra.job.override_dirname}


  job:
    # TODO: Reorganize output dir
    name: ${exp_name}
    num: ${seed}
    chdir: True
    env_set:
      XLA_PYTHON_CLIENT_PREALLOCATE: 'false'
      HYDRA_FULL_ERROR: '1'
    config:
      override_dirname:
        kv_sep: "="
        item_sep: " "
        exclude_keys:
          - model
          - device
          - exp_name
          - model.max_epochs     # Metrics included in model.summary
          - model.dynamic_regime
          - model.orthonormal_w
          - model.ck_w
          - model.equivariant
          - model.max_ck_window_length
          - model.activation
          - model.lr
          - model.batch_norm
          - model.bias
          - system.state_dim     # Metrics included in system.summary
          - system.obs_state_dim
          - system.frames_per_state
          - system.pred_horizon
          - system.eval_pred_horizon
          - system.data_path
          - debug
          - debug_loops
          - seed
          - max_epochs

  sweep:
    dir: ./experiments/${hydra.job.name}/
    subdir: ${system.summary}_${model.summary}_${hydra.job.override_dirname}

  job_logging:
    version: 1
    colorlog: True
    formatters:
      simple:
        format: '[%(levelname)s][%(name)s] %(message)s'
#    handlers:
#      console:
#        class: logging.StreamHandler
#        formatter: simple
#        stream: ext://sys.stdout
#      file:
#        class: logging.handlers.RotatingFileHandler
#        formatter: simple
#        filename: log.log
#        maxBytes: 2048
#        backupCount: 1
#    root:
#      handlers: [console]
#
#    disable_existing_loggers: false

#  sweeper:
##    sampler:
##      _target_: optuna.samplers.TPESampler
##      seed: 123
##      consider_prior: true
##      prior_weight: 1.0
##      consider_magic_clip: true
##      consider_endpoints: false
##      n_startup_trials: 10
##      n_ei_candidates: 24
##      multivariate: false
##    _target_: hydra_plugins.hydra_optuna_sweeper.optuna_sweeper.OptunaS
#    direction: minimize
#    study_name: ${exp_name}
#    storage: null
#    n_trials: 100
#    n_jobs: 8
#    max_failure_rate: 0.1
#    params:
#      model.lr: tag(log, interval(0.0001, 0.1))
#      model.ck_w: tag(log, interval(0.001, 1))
#      model.orthonormal_w: tag(log, interval(0.001, 1))
#      model.max_ck_window_length: choice(3, 6, 12)